<Window x:Class="_4_EFCoreWithSqliteInWPF.MainView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:_4_EFCoreWithSqliteInWPF"
        xmlns:hc="https://handyorg.github.io/handycontrol"
        xmlns:b="http://schemas.microsoft.com/xaml/behaviors"
        mc:Ignorable="d"
        Height="450" Width="800"
        DataContext="{Binding  MainViewModel,Source={StaticResource ServiceLocator}}"
        Title="{Binding Title}">
    <b:Interaction.Triggers>
        <b:EventTrigger EventName="Loaded">
            <b:InvokeCommandAction
                CommandParameter="{Binding}"
                Command="{Binding InitCommand}" />
        </b:EventTrigger>
    </b:Interaction.Triggers>
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="1*" />
            <ColumnDefinition Width="3" />
            <ColumnDefinition Width="3*" />
        </Grid.ColumnDefinitions>

        <Grid x:Name="BookNameNavBar" Grid.Column="0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="1*" />
            </Grid.RowDefinitions>
            <StackPanel Orientation="Horizontal">
                <Button Content="新建" Command="{Binding CreateNewBookCommand}"></Button>
                <Button Content="删除" Command="{Binding DeleteBookCommand}"
                        IsEnabled="{Binding SelectedBook,Converter={x:Static local:MainView.NullToFalseConverter}}">
                </Button>
                <Button Content="刷新" Command="{Binding FlashBookCommand}"></Button>
                <Button Content="提交" Command="{Binding SubmitBookChangeCommand}"></Button>
            </StackPanel>
            <hc:TextBox x:Name="SearchContentTextBox" Grid.Row="1"
                        Text="{Binding SearchText,UpdateSourceTrigger=PropertyChanged}"
                        hc:InfoElement.ShowClearButton="True" />
            <ListBox x:Name="BookNameList" Grid.Row="2"
                     ItemsSource="{Binding FilteredBooks}"
                     SelectedItem="{Binding SelectedBook}">
                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <TextBlock Text="{Binding BookName}">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock">
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsModified}" Value="True">
                                            <Setter Property="Foreground" Value="Red" />
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding IsModified}" Value="False">
                                            <Setter Property="Foreground" Value="Black" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>
        </Grid>
        <GridSplitter Grid.Column="1"
                      HorizontalAlignment="Center"
                      VerticalAlignment="Stretch"
                      Background="Azure"
                      ShowsPreview="True"
                      Width="3" />
        <ContentControl x:Name="BookDetailContent" Grid.Column="2" Content="{Binding  SelectedBook}">
            <ContentControl.Resources>
                <DataTemplate DataType="{x:Type local:BookForShow}">
                    <StackPanel>
                        <hc:TextBox Text="{Binding BookName}"
                                    hc:InfoElement.Title="BookName"
                                    hc:InfoElement.TitlePlacement="Left" />
                        <hc:TextBox Text="{Binding AuthorName}"
                                    hc:InfoElement.Title="AuthorName"
                                    hc:InfoElement.TitlePlacement="Left" />
                        <hc:TextBox Text="{Binding Publisher}"
                                    hc:InfoElement.Title="Publisher"
                                    hc:InfoElement.TitlePlacement="Left" />
                        <hc:DateTimePicker
                            SelectedDateTime="{Binding PublicationYearUtcTick,Converter={StaticResource UtcTickToDateTimeConverter}}" />

                    </StackPanel>
                </DataTemplate>
            </ContentControl.Resources>
        </ContentControl>
    </Grid>
</Window>